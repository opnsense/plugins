#
# /usr/local/etc/autossh/autossh.conf
#
# This file is automatically generated, do not manually edit as changes *will* be lost!
#
# Reference: http://man.openbsd.org/OpenBSD-current/man5/ssh_config.5
#
{% if helpers.exists('VerbNetworks.Autossh.tunnels.tunnel') %}
{% for tunnel_item in helpers.toList('VerbNetworks.Autossh.tunnels.tunnel') %}
{%   for uuid in helpers._template_in_data['__uuid__'] %}
{%     if helpers._template_in_data['__uuid__'][uuid] == tunnel_item %}
{%       set tunnel = helpers.getUUID(uuid) %}
{%       if tunnel.enabled == "1" %}

Host {{ uuid }}

    AddKeysToAgent no
    AddressFamily {{ tunnel.address_family }}
    BatchMode yes
    BindInterface {{ tunnel.bind_interface }}
    CanonicalizeHostname no
    ChallengeResponseAuthentication yes
    CheckHostIP {{ tunnel.check_host_ip }}
    Ciphers {{ tunnel.ciphers }}
    ClearAllForwardings no
    Compression {{ tunnel.compression }}
    ConnectionAttempts {{ tunnel.connection_attempts }}
    ConnectTimeout {{ tunnel.connect_timeout }}
    ControlMaster no
    ControlPath none
    ControlPersist no
{% if tunnel.dynamic_forward %}
    DynamicForward {{ tunnel.dynamic_forward }}
{% endif %}
    EnableSSHKeysign no
    ExitOnForwardFailure yes
    FingerprintHash sha256
    ForwardAgent no
    ForwardX11 no
    ForwardX11Trusted no
    GatewayPorts {{ tunnel.gateway_ports }}
    GlobalKnownHostsFile /dev/null
    HashKnownHosts no
    HostbasedAuthentication no
    HostKeyAlgorithms {{ tunnel.host_key_algorithms }}
    HostKeyAlias {{ uuid }}
    HostName {{ tunnel.hostname }}
    IdentitiesOnly yes
    IdentityAgent none
    IdentityFile /var/db/autossh/{{ uuid }}.identity
    IPQoS none
    KbdInteractiveAuthentication no
    KexAlgorithms {{ tunnel.kex_algorithms }}
    LocalCommand printf "connection: %r@%h:%p\ntimestamp: `date +%%s`\ntunnel_interface: %T\n" > /var/run/autossh.{{ uuid }}.info
{% if tunnel.local_forward %}
    LocalForward {{ tunnel.local_forward }}
{% endif %}
    LogLevel {{ tunnel.log_level }}
    MACs {{ tunnel.macs }}
    NoHostAuthenticationForLocalhost no
    PasswordAuthentication no
    PermitLocalCommand yes
    Port {{ tunnel.port|default("22") }}
    PreferredAuthentications publickey
    # ProxyCommand [todo]
    # ProxyJump [todo]
    # ProxyUseFdpass [todo]
    PubkeyAcceptedKeyTypes {{ tunnel.pubkey_accepted_key_types }}
    PubkeyAuthentication yes
    RekeyLimit {{ tunnel.rekey_limit }}
{% if tunnel.remote_forward %}
    RemoteForward {{ tunnel.remote_forward }}
{% endif %}
    RequestTTY no
    ServerAliveCountMax {{ tunnel.server_alive_count_max }}
    ServerAliveInterval {{ tunnel.server_alive_interval }}
    StreamLocalBindUnlink no
    StrictHostKeyChecking {{ tunnel.strict_host_key_checking }}
    TCPKeepAlive {{ tunnel.tcp_keep_alive }}
    # Tunnel no [todo]
    # TunnelDevice any:any [todo]
    UpdateHostKeys {{ tunnel.update_host_keys }}
    User {{ tunnel.user }}
    UserKnownHostsFile /var/db/autossh/{{ uuid }}.known_hosts
    VerifyHostKeyDNS {{ tunnel.verify_host_key_dns|default("no") }}
    VisualHostKey no

{%       endif %}
{%       break %}
{%     endif %}
{%   endfor %}
{% endfor %}
{% endif %}
