{% from 'OPNsense/Macros/interface.macro' import physical_interface %}
{% if OPNsense.AvahiReflector.enabled|default("0") == "1" %}
{%   set intf_list = OPNsense.AvahiReflector.interfaces|default("lan") %}
{%   set phys_names = [] %}
{%   for intf in intf_list.split(",") %}
{%     set phys = physical_interface(intf) %}
{%     if phys %}
{%       do phys_names.append(phys) %}
{%     endif %}
{%   endfor %}
[server]
domain-name={{ OPNsense.AvahiReflector.domain_name|default("local") }}
use-ipv4={{ "yes" if OPNsense.AvahiReflector.use_ipv4|default("1") == "1" else "no" }}
use-ipv6={{ "yes" if OPNsense.AvahiReflector.use_ipv6|default("0") == "1" else "no" }}
{% if phys_names %}
allow-interfaces={{ phys_names|join(",") }}
{% endif %}
check-response-ttl=no
allow-point-to-point=no

[reflector]
enable-reflector={{ "yes" if OPNsense.AvahiReflector.enable_reflector|default("1") == "1" else "no" }}
reflect-ipv={{ "yes" if OPNsense.AvahiReflector.reflect_ipv|default("0") == "1" else "no" }}
{% if OPNsense.AvahiReflector.reflect_filters|default("") != "" %}
reflect-filters={{ OPNsense.AvahiReflector.reflect_filters }}
{% endif %}

[rlimits]
rlimit-core=0
rlimit-data=4194304
rlimit-fsize=0
rlimit-nofile=768
rlimit-stack=4194304
rlimit-nproc=3
{% endif %}
