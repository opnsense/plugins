<model>
  <mount>//OPNsense/Nginx</mount>
  <description>nginx web server, reverse proxy and waf</description>
  <items>
    <general>
      <enabled type="BooleanField">
        <default>0</default>
        <Required>Y</Required>
      </enabled>
      <enable_redis_plugin type="BooleanField">
        <default>0</default>
        <Required>Y</Required>
      </enable_redis_plugin>
    </general>

    <userlist type="ArrayField">
      <name type="TextField">
        <Required>Y</Required>
      </name>
      <users type="ModelRelationField">
        <Model>
          <template>
            <source>OPNsense.Nginx.Nginx</source>
            <items>credential</items>
            <display>username</display>
          </template>
        </Model>
        <ValidationMessage>Selected user not found</ValidationMessage>
        <Required>Y</Required>
        <multiple>Y</multiple>
      </users>
    </userlist>

    <credential type="ArrayField">
      <username type="TextField">
        <Required>Y</Required>
      </username>
      <password type="TextField">
        <Required>N</Required>
      </password>
    </credential>

    <upstream type="ArrayField">
      <description type="TextField">
        <Required>Y</Required>
      </description>
      <serverentries type="ModelRelationField">
        <Model>
          <template>
            <source>OPNsense.Nginx.Nginx</source>
            <items>upstream_server</items>
            <display>description</display>
          </template>
        </Model>
        <ValidationMessage>Selected server not found</ValidationMessage>
        <Required>Y</Required>
        <multiple>Y</multiple>
      </serverentries>
    </upstream>

    <upstream_server type="ArrayField">
      <description type="TextField">
        <Required>Y</Required>
      </description>
      <server type="HostnameField">
        <Required>Y</Required>
      </server>
      <priority type="IntegerField">
        <MinimumValue>0</MinimumValue>
        <Required>Y</Required>
      </priority>
    </upstream_server>

    <location type="ArrayField">
      <urlpattern type="TextField">
        <Required>Y</Required>
      </urlpattern>
      <matchtype type="OptionField">
        <OptionValues>
          <option1 value="=">Exact Match ("=")</option1>
          <option2 value="~">Case Sensitive Match ("~")</option2>
          <option3 value="~*">Case Insensitive Match ("~*")</option3>
          <option4 value="^~">Don't check regular expressions on logest prefix match ("^~")</option4>
        </OptionValues>
        <Required>N</Required>
      </matchtype>
      <enable_secrules type="BooleanField">
        <default>0</default>
        <Required>Y</Required>
      </enable_secrules>
      <xss_block_score type="IntegerField">
        <Required>N</Required>
      </xss_block_score>
      <sqli_block_score type="BooleanField">
        <Required>N</Required>
      </sqli_block_score>
      <custom_policy type="ModelRelationField">
        <Model>
          <template>
            <source>OPNsense.Nginx.Nginx</source>
            <items>custom_policy</items>
            <display>name</display>
          </template>
        </Model>
        <ValidationMessage>Selected server not found</ValidationMessage>
        <Required>N</Required>
        <multiple>Y</multiple>
      </custom_policy>
      <root type="TextField">
        <Required>N</Required>
      </root>
      <index type="CSVListField">
        <Required>N</Required>
      </index>
      <autoindex type="BooleanField">
        <Required>N</Required>
      </autoindex>
      <authbasic type="TextField">
        <Required>N</Required>
      </authbasic>
      <authbasicuserfile type="ModelRelationField">
        <Model>
          <template>
            <source>OPNsense.Nginx.Nginx</source>
            <items>userlist</items>
            <display>name</display>
          </template>
        </Model>
        <ValidationMessage>Selected server not found</ValidationMessage>
        <Required>N</Required>
        <multiple>Y</multiple>
      </authbasicuserfile>
      <force_https type="TextField">
        <Required>N</Required>
      </force_https>
    </location>

    <custom_policy type="ArrayField">
    </custom_policy>
    <!-- TODO add settings.xml stuff -->
    
    <http_server type="ArrayField">
      <servername type="CSVListField">
        <Required>Y</Required>
      </servername>
      <listen_http_port type="PortField">
        <Required>N</Required>
        <default>80</default>
      </listen_http_port>
      <listen_https_port type="PortField">
        <Required>N</Required>
        <default>443</default>
      </listen_https_port>
      <locations type="ModelRelationField">
        <Model>
          <template>
            <source>OPNsense.Nginx.Nginx</source>
            <items>location</items>
            <display>urlpattern</display>
          </template>
        </Model>
        <ValidationMessage>Selected location(s) not found</ValidationMessage>
        <Required>N</Required>
        <multiple>Y</multiple>
      </locations>
      <root type="TextField">
        <Required>N</Required>
      </root>
      <certificate type="CertificateField">
        <Type>cert</Type>
        <Required>N</Required>
      </certificate>
      <ca type="CertificateField">
        <Type>ca</Type>
        <Required>N</Required>
      </ca>
      <verify_client type="OptionField">
        <default>Off</default>
        <OptionValues>
          <off>Off</off>
          <on>On</on>
          <optional>Optional</optional>
          <optional_no_ca>Optional, don't verify</optional_no_ca>
        </OptionValues>
        <Required>Y</Required>
      </verify_client>
      <access_log_format type="OptionField">
        <default>default</default>
        <OptionValues>
          <default>Default</default>
          <anonymized>Anonymized</anonymized>
          <disabled>Disabled</disabled>
        </OptionValues>
        <Required>Y</Required>
      </access_log_format>
      <charset type="OptionField">
        <default>utf-8</default>
        <OptionValues>
          <utf-8>utf-8</utf-8>
        </OptionValues>
        <Required>N</Required>
      </charset>
      <https_only type="BooleanField">
        <default>0</default>
        <Required>Y</Required>
      </https_only>
      <block_nonpublic_data type="BooleanField">
        <default>0</default>
        <Required>Y</Required>
      </block_nonpublic_data>
      <naxsi_extensive_log type="BooleanField">
        <default>0</default>
        <Required>Y</Required>
      </naxsi_extensive_log>
      <sendfile type="BooleanField">
        <default>1</default>
        <Required>Y</Required>
      </sendfile>
    </http_server>

  </items>
</model>
