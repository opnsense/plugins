{% if helpers.exists('OPNsense.bind.general.enabled') and OPNsense.bind.general.enabled == '1' %}
{%   if helpers.exists('OPNsense.bind.domain.domains.domain') %}
{%     for domaindb in helpers.toList('OPNsense.bind.domain.domains.domain') %}
{%       if TARGET_FILTERS['OPNsense.bind.domain.domains.domain.' ~ loop.index0] or TARGET_FILTERS['OPNsense.bind.domain.domains.domain'] %}
{%         if domaindb.enabled == '1' and domaindb.type == 'primary' %}
$TTL {{ domaindb.ttl }}
@       IN      SOA    {{ domaindb.dnsserver }}. {{ domaindb.mailadmin|replace('@', '.') }}. ( {{ domaindb.serial|trim }} {{ domaindb.refresh }} {{ domaindb.retry }} {{ domaindb.expire }} {{ domaindb.negative }} )
{%           if helpers.exists('OPNsense.bind.record.records.record') %}
{%             for record in helpers.sortDictList(OPNsense.bind.record.records.record, 'name', 'type' ) %}
{%               if record.domain == domaindb['@uuid'] %}
{{ record.name }}                {{ record.type }} {{ record.value }}
{%             endif %}
{%           endfor %}
{%           if helpers.exists('dhcpd') and helpers.exists('OPNsense.bind.general.dhcpstaticmappings') and OPNsense.bind.general.dhcpstaticmappings == '1' %}
{%             for interface_name, interface in dhcpd.items() %}
{%               if 'staticmap' in interface %}
{%                 for staticmapping in interface.staticmap %}
{%                   if (('ddnsdomain' in staticmapping) or ('ddnsdomain' in interface)) and 'ipaddr' in staticmapping and 'hostname' in staticmapping %}
{%                     set ddnsdomain=staticmapping.ddnsdomain if ('ddnsdomain' in staticmapping) else interface.ddnsdomain %}
{%                     if domaindb.domainname == ddnsdomain %}
{{ staticmapping.hostname }}                A {{ staticmapping.ipaddr }}
{%                     elif domaindb.domainname == '.'.join(staticmapping.ipaddr.split('.')[-2::-1]) + '.in-addr.arpa' %}
{{ staticmapping.ipaddr.split('.')[3] }}                PTR {{ staticmapping.hostname }}.{{ ddnsdomain }}.
{%                     endif %}
{%                   endif %}
{%                 endfor %}
{%               endif %}
{%             endfor %}
{%           endif %}
{%         endif %}
{%       endif %}
{%     endfor %}
{%   endif %}
{% endif %}
