{% set security_rule = OPNsense.nginx.security_rule %}
{% if security_rule.referrer is defined %}
add_header Referrer-Policy "{{ security_rule.referrer }}" always;
{% endif %}
{% if security_rule.xssprotection is defined %}
add_header X-XSS-Protection "{{ security_rule.xssprotection }}" always;
{% endif %}
{% if security_rule.content_type_options is defined and security_rule.content_type_options == '1' %}
add_header X-Content-Type-Options "nosniff" always;
{% endif %}
{% if security_rule.strict_transport_security is defined %}
{%   if security_rule.strict_transport_security.time is defined %}
add_header Strict-Transport-Security "{{ security_rule.strict_transport_security.time }}{%
  if security_rule.strict_transport_security.include_subdomains is defined and
     security_rule.strict_transport_security.include_subdomains == '1' %}; includeSubDomains{% endif %}" always;
{%   endif %}
{% endif %}
{% if security_rule.hpkp is defined %}
{%   if security_rule.hpkp.keys is defined and security_rule.hpkp.time is defined %}
add_header Public-Key-Pins{# -Report-Only #} "{{ security_rule.hpkp.keys }}; max-age={{ ecurity_rule.hpkp.time }}{%
  if security_rule.hpkp.include_subdomains is defined and
     security_rule.hpkp.include_subdomains == '1' %}; includeSubDomains{% endif %}" always;
{%   endif %}
{% endif %}
Public-Key-Pins: pin-sha256="<pin-value>";
                 max-age=<expire-time>;
                 includeSubDomains;
                 report-uri="<uri>"