{% if helpers.exists('OPNsense.sso_ad.general') and OPNsense.sso_ad.general.Enabled|default("0") == "1" %}
[libdefaults]
    default_realm = {{ OPNsense.sso_ad.general.DomainName|upper }}
    dns_lookup_kdc = no
    dns_lookup_realm = no
    ticket_lifetime = 24h
    default_keytab_name = /usr/local/etc/sso_ad/PROXY.keytab

{% if helpers.exists('OPNsense.sso_ad.general.DomainVersion') and OPNsense.sso_ad.general.DomainVersion  == 'Windows 2003' %}
    default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
    default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
    permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
{% endif %}
{% if helpers.exists('OPNsense.sso_ad.general.DomainVersion') and OPNsense.sso_ad.general.DomainVersion  == 'Windows 2008 with AES' %}
; for Windows 2008 with AES
    default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
    default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
    permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
{% endif %}

[realms]
    {{ OPNsense.sso_ad.general.DomainName|upper }} = {
        kdc = {{ OPNsense.sso_ad.general.DomainDC|lower }}
        admin_server = {{ OPNsense.sso_ad.general.DomainDC|lower }} 
        default_domain = {{ OPNsense.sso_ad.general.DomainName|lower }}
    }

[domain_realm]
    .example.local = {{ OPNsense.sso_ad.general.DomainName|upper }}
    example.local = {{ OPNsense.sso_ad.general.DomainName|upper }}

{% endif %}
