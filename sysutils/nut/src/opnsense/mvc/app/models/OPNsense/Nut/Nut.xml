<model>
  <mount>//OPNsense/Nut</mount>
  <description>Network UPS Tools</description>
  <version>2.0.0</version>
  <items>
    <!-- nut.conf -->
    <general>
      <!-- global service enable -->
      <enable type="BooleanField">
        <Default>0</Default>
        <Required>Y</Required>
      </enable>
      <mode type="OptionField">
        <Default>standalone</Default>
        <Required>Y</Required>
        <OptionValues>
          <!-- no functional difference between standalone and netserver modes -->
          <standalone>standalone</standalone>
          <netserver>netserver</netserver>
          <netclient>netclient</netclient>
        </OptionValues>
      </mode>
      <extra_options type="CSVListField">
        <FieldSeparator>;</FieldSeparator>
      </extra_options>
    </general>

    <!-- ups.conf -->
    <drivers>
      <extra_global_options type="CSVListField">
        <FieldSeparator>;</FieldSeparator>
      </extra_global_options>
      <ups type="ArrayField">
        <enabled type="BooleanField">
          <Default>1</Default>
          <Required>Y</Required>
        </enabled>
        <name type="TextField">
          <Default>main</Default>
          <Required>Y</Required>
          <mask>/^([0-9a-zA-Z._\-]){1,128}$/u</mask>
          <ValidationMessage>The name should only contain alphanumeric characters, dashes, underscores or a dot.</ValidationMessage>
        </name>
        <driver type="TextField">
          <Required>Y</Required>
        </driver>
        <options type="CSVListField">
          <Default>port=auto</Default>
          <FieldSeparator>;</FieldSeparator>
        </options>
      </ups>
    </drivers>

    <!-- upsd.conf -->
    <data_server>
      <listen type="IPPortField">
        <AsList>Y</AsList>
        <Default>127.0.0.1:3493,[::1]:3493</Default>
      </listen>
      <extra_options type="CSVListField">
        <FieldSeparator>;</FieldSeparator>
      </extra_options>
    </data_server>

    <!-- upsd.users -->
    <user type="ArrayField">
      <enabled type="BooleanField">
        <Required>Y</Required>
        <Default>1</Default>
      </enabled>
      <username type="TextField">
        <Required>Y</Required>
      </username>
      <password type="TextField">
        <Required>Y</Required>
      </password>
      <actions type="CSVListField">
        <FieldSeparator>;</FieldSeparator>
      </actions>
      <instcmds type="CSVListField">
        <FieldSeparator>;</FieldSeparator>
      </instcmds>
      <upsmon type="OptionField">
        <Default>none</Default>
        <Required>Y</Required>
        <OptionValues>
          <none>none</none>
          <primary>primary</primary>
          <secondary>secondary</secondary>
        </OptionValues>
      </upsmon>
    </user>

    <!-- upsmon.conf -->
    <monitoring>
      <minimum_supplies type="IntegerField">
        <Required>Y</Required>
        <MinimumValue>0</MinimumValue>
        <Default>1</Default>
        <ValidationMessage>The minimum required supplies must be greater than or equal to 0.</ValidationMessage>
      </minimum_supplies>
      <extra_options type="CSVListField">
        <FieldSeparator>;</FieldSeparator>
      </extra_options>>
      <local type="ArrayField">
        <enabled type="BooleanField">
          <Required>Y</Required>
          <Default>1</Default>
        </enabled>
        <ups type="ModelRelationField">
          <Required>Y</Required>
          <Model>
            <ups>
              <source>OPNsense.Nut.Nut</source>
              <items>drivers.ups</items>
              <display>name</display>
            </ups>
          </Model>
        </ups>
        <user type="ModelRelationField">
          <Required>Y</Required>
          <Model>
            <user>
              <source>OPNsense.Nut.Nut</source>
              <items>user</items>
              <display>username</display>
              <filters>
                <upsmon>/^primary$/</upsmon>
              </filters>
            </user>
          </Model>
        </user>
        <power_value type="IntegerField">
          <Required>Y</Required>
          <MinimumValue>0</MinimumValue>
          <Default>1</Default>
          <ValidationMessage>The power value must be greater than or equal to 0.</ValidationMessage>
        </power_value>
      </local>
      <remote type="ArrayField">
        <enabled type="BooleanField">
          <Required>Y</Required>
          <Default>1</Default>
        </enabled>
        <ups_name type="TextField">
          <Required>Y</Required>
          <mask>/^([0-9a-zA-Z._\-]){1,128}$/u</mask>
          <ValidationMessage>The name should only contain alphanumeric characters, dashes, underscores or a dot.</ValidationMessage>
        </ups_name>
        <hostname type="HostnameField">
          <Required>Y</Required>
        </hostname>
        <port type="PortField">
          <Required>Y</Required>
          <Default>3493</Default>
        </port>
        <power_value type="IntegerField">
          <Required>Y</Required>
          <MinimumValue>0</MinimumValue>
          <Default>1</Default>
          <ValidationMessage>The power value must be greater than or equal to 0.</ValidationMessage>
        </power_value>
        <username type="TextField">
          <Required>Y</Required>
        </username>
        <password type="TextField">
          <Required>Y</Required>
        </password>
      </remote>
    </monitoring>
  </items>
</model>
