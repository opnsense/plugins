[start]
command:/usr/local/opnsense/scripts/OPNsense/MetricsExporter/generate_config.php && /usr/sbin/daemon -u nobody -f -p /var/run/metrics_exporter.pid /usr/local/opnsense/scripts/OPNsense/MetricsExporter/metrics_exporter.php
parameters:
type:script
message:Starting Metrics Exporter

[stop]
command:/bin/pkill -F /var/run/metrics_exporter.pid 2>/dev/null; rm -f /var/run/metrics_exporter.pid; exit 0
parameters:
type:script
message:Stopping Metrics Exporter

[restart]
command:/bin/pkill -F /var/run/metrics_exporter.pid 2>/dev/null; rm -f /var/run/metrics_exporter.pid; sleep 1; /usr/local/opnsense/scripts/OPNsense/MetricsExporter/generate_config.php && /usr/sbin/daemon -u nobody -f -p /var/run/metrics_exporter.pid /usr/local/opnsense/scripts/OPNsense/MetricsExporter/metrics_exporter.php
parameters:
type:script
message:Restarting Metrics Exporter

[reconfigure]
command:/usr/local/opnsense/scripts/OPNsense/MetricsExporter/generate_config.php && /bin/pkill -HUP -F /var/run/metrics_exporter.pid 2>/dev/null; exit 0
parameters:
type:script
message:Reconfiguring Metrics Exporter

[collector-status]
command:/usr/local/opnsense/scripts/OPNsense/MetricsExporter/metrics_status.php
parameters:
type:script_output
message:Fetching collector status

[list-collectors]
command:/usr/local/opnsense/scripts/OPNsense/MetricsExporter/list_collectors.php
parameters:
type:script_output
message:Listing available collectors

[status]
command:if [ -f /var/run/metrics_exporter.pid ] && /bin/pgrep -qF /var/run/metrics_exporter.pid 2>/dev/null; then echo "metrics_exporter is running as pid $(cat /var/run/metrics_exporter.pid)."; else echo "metrics_exporter is not running."; fi
parameters:
type:script_output
message:Checking Metrics Exporter status
