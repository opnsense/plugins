#
# This file is automatically generated. Do not manually edit this file - changes *will* be lost!
#
{% if helpers.exists('OPNsense.NodeExporter.enabled') and OPNsense.NodeExporter.enabled == '1' %}

{%- set collector = "--collector." -%}
{%- set no_collector = "--no-collector." -%}

{%- if helpers.empty('OPNsense.NodeExporter.cpu') -%}
    {%- set cpu = no_collector + "cpu " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.exec') -%}
    {%- set exec = no_collector + "exec " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.filesystem') -%}
    {%- set filesystem = no_collector + "filesystem " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.loadavg') -%}
    {%- set loadavg = no_collector + "loadavg " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.meminfo') -%}
    {%- set meminfo = no_collector + "meminfo " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.netdev') -%}
    {%- set netdev = no_collector + "netdev " -%}
{%- endif -%}

{%- if OPNsense.NodeExporter.ntp == '1' -%}
    {%- set ntp = collector + "ntp " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.time') -%}
    {%- set time = no_collector + "time " -%}
{%- endif -%}

{%- if OPNsense.NodeExporter.devstat == '1' -%}
    {%- set devstat = collector + "devstat " -%}
{%- endif -%}

{%- if helpers.empty('OPNsense.NodeExporter.zfs') -%}
    {%- set zfs = no_collector + "zfs " -%}
{%- endif -%}

{%- if ':' in OPNsense.NodeExporter.listenaddress -%}
  {%- set listenaddress = '[' + OPNsense.NodeExporter.listenaddress + ']' -%}
{%- else -%}
  {%- set listenaddress = OPNsense.NodeExporter.listenaddress -%}
{%- endif -%}

node_exporter_args="{{ cpu }}{{ exec }}{{ filesystem }}{{ loadavg }}{{ meminfo }}{{ netdev }}{{ ntp }}{{ time }}{{ devstat }}{{ zfs }}"
node_exporter_listen_address="{{ listenaddress }}:{{ OPNsense.NodeExporter.listenport }}"
node_exporter_enable="YES"

{%- else -%}

node_exporter_enable="NO"

{%- endif -%}
