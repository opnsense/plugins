#
# Automatically generated configuration.
# Do not edit this file manually.

{% if helpers.exists('OPNsense.ZabbixAgent.settings') %}

############ GENERAL PARAMETERS #################

PidFile=/var/run/zabbix/zabbix_agentd.pid

{% if helpers.exists('OPNsense.ZabbixAgent.settings.main.syslogEnable') and OPNsense.ZabbixAgent.settings.main.syslogEnable|default('0') == '1' %}
LogType=system
{% else %}
LogType=file
LogFile=/var/log/zabbix/zabbix_agentd.log
LogFileSize={{OPNsense.ZabbixAgent.settings.main.logFileSize}}
{% endif %}

DebugLevel={{OPNsense.ZabbixAgent.settings.main.debugLevel|replace("val_", "")}}

{% if helpers.exists('OPNsense.ZabbixAgent.settings.main.sourceIP') %}
SourceIP={{OPNsense.ZabbixAgent.settings.main.sourceIP}}
{% endif %}

EnableRemoteCommands={{OPNsense.ZabbixAgent.settings.features.enableRemoteCommands}}
LogRemoteCommands={{OPNsense.ZabbixAgent.settings.features.logRemoteCommands}}

Server={{OPNsense.ZabbixAgent.settings.main.serverList}}
ListenPort={{OPNsense.ZabbixAgent.settings.main.listenPort}}
ListenIP={{OPNsense.ZabbixAgent.settings.main.listenIP}}

{% if OPNsense.ZabbixAgent.settings.features.enableActiveChecks == '1' and OPNsense.ZabbixAgent.settings.features.activeCheckServers|default("") != "" %}
ServerActive={{OPNsense.ZabbixAgent.settings.features.activeCheckServers}}
{% endif %}

{% if OPNsense.ZabbixAgent.local.hostname|default("") != "" %}
Hostname={{OPNsense.ZabbixAgent.local.hostname}}
{% endif %}

StartAgents={{OPNsense.ZabbixAgent.settings.tuning.startAgents}}
RefreshActiveChecks={{OPNsense.ZabbixAgent.settings.features.refreshActiveChecks}}
BufferSend={{OPNsense.ZabbixAgent.settings.tuning.bufferSend}}
BufferSize={{OPNsense.ZabbixAgent.settings.tuning.bufferSize}}
MaxLinesPerSecond={{OPNsense.ZabbixAgent.settings.tuning.maxLinesPerSecond}}

{% if OPNsense.ZabbixAgent.settings.features.encryption == '1' %}
{%   if OPNsense.ZabbixAgent.settings.features.encryptionidentity != '' %}
{%     if OPNsense.ZabbixAgent.settings.features.encryptionpsk != '' %}
TLSAccept=psk
TLSConnect=psk
TLSPSKFile=/usr/local/etc/zabbix_agent.psk
TLSPSKIdentity={{ OPNsense.ZabbixAgent.settings.features.encryptionidentity }}
{%     endif %}
{%   endif %}
{% endif %}

############ ADVANCED PARAMETERS #################

{% if helpers.exists('OPNsense.ZabbixAgent.aliases') %}
{%   for alias in helpers.toList('OPNsense.ZabbixAgent.aliases.alias') %}
{%     if alias.enabled == '1' %}
{%       if alias.acceptParams == '1' %}
{%         set alias_opts = '[*]' %}
{%       endif %}
Alias={{alias.key}}{{alias_opts}}:{{alias.sourceKey}}
{%     endif %}
{%   endfor %}
{% endif %}

Timeout={{OPNsense.ZabbixAgent.settings.tuning.timeout}}
AllowRoot=0
User=zabbix
Include=/usr/local/etc/zabbix_agentd.conf.d

####### USER-DEFINED MONITORED PARAMETERS #######

{% if helpers.exists('OPNsense.ZabbixAgent.userparameters') %}
{%   for userparam in helpers.toList('OPNsense.ZabbixAgent.userparameters.userparameter') %}
{%     if userparam.enabled == '1' %}
{%       if userparam.acceptParams == '1' %}
{%         set userparam_opts = '[*]' %}
{%       endif %}
UserParameter={{userparam.key}}{{userparam_opts}},{{userparam.command}}
{%     endif %}
{%   endfor %}
{% endif %}

{% endif %}
