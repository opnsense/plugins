{% if helpers.exists('OPNsense.collectd.general.enabled') and OPNsense.collectd.general.enabled == '1' %}

{% if helpers.exists('OPNsense.collectd.general.hostname') and OPNsense.collectd.general.hostname != '' %}
Hostname    "{{ OPNsense.collectd.general.hostname }}"
{% endif %}
{% if helpers.exists('OPNsense.collectd.general.fqdnlookup') and OPNsense.collectd.general.fqdnlookup == '1' %}
FQDNLookup    true
{% endif %}
{% if helpers.exists('OPNsense.collectd.general.interval') and OPNsense.collectd.general.interval != '' %}
Interval    {{ OPNsense.collectd.general.interval }}
{% endif %}




LoadPlugin syslog
<Plugin syslog>
       LogLevel info
</Plugin>

LoadPlugin contextswitch
LoadPlugin cpu
LoadPlugin df
LoadPlugin interface
LoadPlugin load
LoadPlugin memory
LoadPlugin network
LoadPlugin processes
LoadPlugin uptime
LoadPlugin users
LoadPlugin write_graphite


##############################################################################
# Plugin configuration                                                       #
#----------------------------------------------------------------------------#
# In this section configuration stubs for each plugin are provided. A desc-  #
# ription of those options is available in the collectd.conf(5) manual page. #
##############################################################################

#<Plugin cpu>
#  ReportByCpu true
#  ReportByState true
#  ValuesPercentage false
#</Plugin>

#<Plugin df>
#       Device "/dev/hda1"
#       Device "192.168.0.2:/mnt/nfs"
#       MountPoint "/home"
#       FSType "ext3"
#       IgnoreSelected false
#       ReportByDevice false
#       ReportInodes false
#       ValuesAbsolute true
#       ValuesPercentage false
#</Plugin>

#<Plugin disk>
#       Disk "/^[hs]d[a-f][0-9]?$/"
#       IgnoreSelected false
#       UseBSDName false
#       UdevNameAttr "DEVNAME"
#</Plugin>

#<Plugin interface>
#       Interface "eth0"
#       IgnoreSelected false
#       ReportInactive true
#       UniqueName false
#</Plugin>

#<Plugin load>
#        ReportRelative true
#</Plugin>

#<Plugin memory>
#       ValuesAbsolute true
#       ValuesPercentage false
#</Plugin>

{% if helpers.exists('OPNsense.collectd.general.p_network_enable') and OPNsense.collectd.general.p_network_enable == '1' %}
{%   if helpers.exists('OPNsense.collectd.general.p_network_host') and OPNsense.collectd.general.p_network_host != '' %}
{%     if helpers.exists('OPNsense.collectd.general.p_network_host') and OPNsense.collectd.general.p_network_host != '' %}
<Plugin network>
        <Server "{{ OPNsense.collectd.general.p_network_host }}" "{{ OPNsense.collectd.general.p_network_port }}">
{%       if helpers.exists('OPNsense.collectd.general.p_network_username') and OPNsense.collectd.general.p_network_username != '' %}
                Username "{{ OPNsense.collectd.general.p_network_username }}"
{%       endif %}
{%       if helpers.exists('OPNsense.collectd.general.p_network_password') and OPNsense.collectd.general.p_network_password != '' %}
                Password "{{ OPNsense.collectd.general.p_network_password }}"
{%       endif %}
{%       if helpers.exists('OPNsense.collectd.general.p_network_username') and OPNsense.collectd.general.p_network_username != '' %}
{%         if helpers.exists('OPNsense.collectd.general.p_network_encryption') and OPNsense.collectd.general.p_network_encryption == '1' %}
                SecurityLevel Encrypt
{%         endif %}
{%       endif %}
        </Server>
</Plugin>
{%     endif %}
{%   endif %}
{% endif %}


#<Plugin processes>
#       Process "name"
#</Plugin>

#<Plugin swap>
#       ReportByDevice false
#       ReportBytes true
#       ValuesAbsolute true
#       ValuesPercentage false
#</Plugin>

#<Plugin write_graphite>
#  <Node "example">
#    Host "localhost"
#    Port "2003"
#    Protocol "tcp"
#    ReconnectInterval 0
#    LogSendErrors true
#    Prefix "collectd"
#    Postfix "collectd"
#    StoreRates true
#    AlwaysAppendDS false
#    EscapeCharacter "_"
#    SeparateInstances false
#    PreserveSeparator false
#    DropDuplicateFields false
#  </Node>
#</Plugin>


##############################################################################
# Filter configuration                                                       #
#----------------------------------------------------------------------------#
# The following configures collectd's filtering mechanism. Before changing   #
# anything in this section, please read the `FILTER CONFIGURATION' section   #
# in the collectd.conf(5) manual page.                                       #
##############################################################################

# Load required matches:
#LoadPlugin match_empty_counter
#LoadPlugin match_hashed
#LoadPlugin match_regex
#LoadPlugin match_value
#LoadPlugin match_timediff

# Load required targets:
#LoadPlugin target_notification
#LoadPlugin target_replace
#LoadPlugin target_scale
#LoadPlugin target_set
#LoadPlugin target_v5upgrade

#----------------------------------------------------------------------------#
# The following block demonstrates the default behavior if no filtering is   #
# configured at all: All values will be sent to all available write plugins. #
#----------------------------------------------------------------------------#

#<Chain "PostCache">
#  Target "write"
#</Chain>

##############################################################################
# Threshold configuration                                                    #
#----------------------------------------------------------------------------#
# The following outlines how to configure collectd's threshold checking      #
# plugin. The plugin and possible configuration options are documented in    #
# the collectd-threshold(5) manual page.                                     #
##############################################################################

#LoadPlugin "threshold"
#<Plugin threshold>
#  <Type "foo">
#    WarningMin    0.00
#    WarningMax 1000.00
#    FailureMin    0.00
#    FailureMax 1200.00
#    Invert false
#    Instance "bar"
#  </Type>
#
#  <Plugin "interface">
#    Instance "eth0"
#    <Type "if_octets">
#      FailureMax 10000000
#      DataSource "rx"
#    </Type>
#  </Plugin>
#
#  <Host "hostname">
#    <Type "cpu">
#      Instance "idle"
#      FailureMin 10
#    </Type>
#
#    <Plugin "memory">
#      <Type "memory">
#        Instance "cached"
#        WarningMin 100000000
#      </Type>
#    </Plugin>
#
#    <Type "load">
#       DataSource "midterm"
#       FailureMax 4
#       Hits 3
#       Hysteresis 3
#    </Type>
#  </Host>
#</Plugin>
{% endif %}
