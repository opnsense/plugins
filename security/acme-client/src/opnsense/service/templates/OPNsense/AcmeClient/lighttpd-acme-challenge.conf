#
# Automatically generated configuration.
# Do not edit this file manually.

{% if helpers.exists('OPNsense.AcmeClient.settings') %}

# FreeBSD!
server.event-handler = "freebsd-kqueue"
server.network-backend = "writev"
#server.use-ipv6 = "enable"

# modules to load
server.modules = ( "mod_access", "mod_expire", "mod_deflate", "mod_redirect",
  "mod_alias", "mod_rewrite"
)

server.max-keep-alive-requests = 2
server.max-keep-alive-idle = 30

# a static document-root, for virtual-hosting take look at the
# server.virtual-* options
server.document-root = "/var/empty"

# ACME challenges
alias.url += ( "/.well-known/acme-challenge/" => "/var/etc/acme-client/challenges/.well-known/acme-challenge/" )

# Maximum idle time with nothing being written
server.max-write-idle = 90

# where to send error-messages to
server.errorlog-use-syslog = "enable"

# files to check for if .../ is requested
server.indexfiles = ( "index.html" )

# mimetype mapping
mimetype.assign             = (
  ".gz"           =>      "application/x-gzip",
  ".tar.gz"       =>      "application/x-tgz",
  ".tgz"          =>      "application/x-tgz",
  ".tar"          =>      "application/x-tar",
  ".zip"          =>      "application/zip",
  ".css"          =>      "text/css",
  ".html"         =>      "text/html",
  ".htm"          =>      "text/html",
  ".js"           =>      "text/javascript",
  ".asc"          =>      "text/plain",
  ".c"            =>      "text/plain",
  ".conf"         =>      "text/plain",
  ".text"         =>      "text/plain",
  ".txt"          =>      "text/plain",
  ".dtd"          =>      "text/xml",
  ".xml"          =>      "text/xml",
  ".bz2"          =>      "application/x-bzip",
  ".tbz"          =>      "application/x-bzip-compressed-tar",
  ".tar.bz2"      =>      "application/x-bzip-compressed-tar"
 )

# deny access to file-extensions
url.access-deny = ( "~", ".inc" )

# bind to port
server.bind = "127.0.0.1"
server.port = {{OPNsense.AcmeClient.settings.challengePort}}
$SERVER["socket"]  == "127.0.0.1:{{OPNsense.AcmeClient.settings.challengePort}}" { }

{% if helpers.exists('system.ipv6allow') and system.ipv6allow|default("0") == "1" %}
# IPv6
$SERVER["socket"]  == "[::1]:{{OPNsense.AcmeClient.settings.challengePort}}" { }
{% endif %}

# to help the rc.scripts
server.pid-file = "/var/run/lighttpd-acme-challenge.pid"

# enable debugging
debug.log-request-header   = "disable"
debug.log-response-header  = "disable"
debug.log-request-handling = "disable"
debug.log-file-not-found   = "disable"

# enable compression
deflate.cache-dir = "/tmp/acmelighttpdcompress/"
deflate.mimetypes = ("text/plain", "text/css", "text/xml", "text/javascript")
deflate.allowed-encodings = ("br", "gzip", "deflate")

server.max-request-size = 4096
server.tag = "lighttpd/ACME"

expire.url = ( "" => "access 10 hours" )

{% endif %}
