{% if helpers.exists('OPNsense.maltrail.server.enabled') and OPNsense.maltrail.server.enabled == '1' %}

# [Server]
HTTP_ADDRESS {{ OPNsense.maltrail.server.listenaddress }}
HTTP_PORT {{ OPNsense.maltrail.server.listenport }}
USE_SSL false
USERS
    admin:9ab3cd9d67bf49d01f6a2e33d0bd9bc804ddbe6ce1ff5d219c42624851db5dbc:2000:0.0.0.0/0                        # changeme!

{%   if helpers.exists('OPNsense.maltrail.server.loglistenaddress') and OPNsense.maltrail.server.loglistenaddress != '' %}
UDP_ADDRESS {{ OPNsense.maltrail.server.loglistenaddress }}
{%   endif %}
{%   if helpers.exists('OPNsense.maltrail.server.loglistenport') and OPNsense.maltrail.server.loglistenport != '' %}
UDP_PORT {{ OPNsense.maltrail.server.loglistenport }}
{%   endif %}

USE_SERVER_UPDATE_TRAILS false
{% endif %}

{% if helpers.exists('OPNsense.maltrail.general.enabled') and OPNsense.maltrail.general.enabled == '1' %}
# [Sensor]


PROCESS_COUNT $CPU_CORES
DISABLE_CPU_AFFINITY false
USE_FEED_UPDATES true
DISABLED_FEEDS turris, ciarmy, policeman, myip
UPDATE_PERIOD 86400
CUSTOM_TRAILS_DIR /usr/local/maltrail/trails/custom/
CAPTURE_BUFFER 10%
MONITOR_INTERFACE any
CAPTURE_FILTER udp or icmp or (tcp and (tcp[tcpflags] == tcp-syn or port 80 or port 1080 or port 3128 or port 8000 or port 8080 or port 8118))
SENSOR_NAME $HOSTNAME

{%   if helpers.exists('OPNsense.maltrail.general.remoteserver') and OPNsense.maltrail.general.remoteserver != '' %}
LOG_SERVER {{ OPNsense.maltrail.general.remoteserver }}:{{ OPNsense.maltrail.general.remoteport }}
DISABLE_LOCAL_LOG_STORAGE true
{%   else %}
DISABLE_LOCAL_LOG_STORAGE false
{%   endif %}

USE_HEURISTICS true
CHECK_MISSING_HOST false
CHECK_HOST_DOMAINS false

# [All]
SHOW_DEBUG false
LOG_DIR $SYSTEM_LOG_DIR/maltrail
{% endif %}